<!DOCTYPE html>
<html>
	<head>
		<title>How to Boot Windows 7 in Pure UEFI mode</title>
		<meta charset="utf-8">
		<style>
			body {
				font-family: Montserrat, sans-serif;
				font-style: normal !important;
				font-size: 12pt;
				color: #121212;
				padding: 1.6em 12em;
				margin: 0;
				background-color: #f0f0f0;
			}
			footer {
				font-size: 11pt;
				padding: 1.8em 0 1.6em 0;
			}
			code {
				background: #e0e0e0;
				border-radius: 0.25em;
				border: solid 1px #d0d0d0;
				font-family: "Courier New", monospace;
				font-size: 1em;
				margin: 0 0.25em;
				padding: 0.25em 0.25em;
			}
			pre {
				font-family: "Courier New", monospace;
				font-size: 1em;
				margin: 0;
			}
				pre code {
					display: block;
					line-height: 1.25em;
					padding: 1em;
					overflow-x: auto;
				}
			p {
				line-height: 150%;
				padding: 0;
				margin: 0 0 0.5em 0;
			}
			p.first {
				margin: 1em 0 0.5em 0;
			}
			b, strong {
				font-style: bold;
			}
			i, em {
				font-style: italic;
			}
			.underline {
				text-decoration: underline;
			}
			a {
				text-decoration: none;
				color: #003955;
			}
			a:hover {
				text-decoration: underline;
			}
			.title {
				font-size: 26pt;
				line-height: 150%;
				padding: 0;
				margin: 0;
			}
			.subtitle {
				font-size: 11pt;
				font-style: italic;
				line-height: 150%;
				padding: 0;
				margin: 0;
			}
			h1, h2, h3 {
				font-weight: normal !important;
				line-height: 150%;
				padding: 0;
				margin: 0 0 0.5em 0;
			}
				h1 {
					font-size: 18pt;
				}
				h2 {
					font-size: 16pt;
				}
				h3 {
					font-size: 14pt;
				}
			ul {
				line-height: 150%;
			}
			ul.toc {
				list-style: none;
				padding: 0;
				margin: 0 0 0.5em 0;
			}
				ul.toc > li.header {
					font-size: 14pt;
				ul.toc > li {
					text-decoration: none;
					color: rgb(0, 57, 85);
				}
		</style>
	</head>
	<body>
		<div class="title" id="top">
			How to Boot Windows 7 in Pure UEFI mode
		</div>
		<div class="subtitle">Yes, this is what you think it is...</div>
		<p class="first">So Windows 7 doesn't natively support booting in pure UEFI mode (with CSM disabled) on 99% of systems because Microsoft didn't really feel like implementing proper UEFI boot in 2009. Most computers still didn't support UEFI at all, and those that did always had CSM enabled by default. However, it's still possible with a few modifications. And on a handful of systems, you can boot Windows 7 natively on pure UEFI. For those systems that can't do that, this is my way of remedying the matter. It's the way that actually works on 99% of systems. Basically, it involves replacing some critical boot files on Windows 7's EFI partition with the Windows 10 versions. Windows 8 files should work as well, since that was when Microsoft properly implemented UEFI boot (without requiring CSM) in Windows.</p>
		<br>
		<ul class="toc">
			<li class="header">Table of Contents</li>
			<li><a href="#prerequisites">Prerequisites and things to note</a></li>
			<li><a href="#installing-the-os">1: Installing the OS</a></li>
			<li><a href="#editing-registry-boot-config">2: Editing the registry and modifying the boot configuration</a></li>
			<ul>
				<li><a href="#registry-editing">Editing the registry</a></li>
				<li><a href="#boot-config">Modifying the boot configuration</a></li>
			</ul>
			<li><a href="#replace-boot-files">3: Replacing the boot files</a></li>
			<ul><li><a href="#for-full-win10-install">Special instructions when using a full Win8 or 10 installation</a></li></ul>
			<li><a href="#boot-windows-7">4: Boot Windows 7 and hope it works!</a></li>
			<li><a href="#credits">Credits</a></li>
		</ul>
		<br>
		<h1 id="prerequisites">Prerequisites and things to note</h1>
		<p>So a couple things we need to get out of the way before attempting this:</p>
		<ul>
			<li>You <b>MUST</b> have the correct graphics card drivers installed to do this! This has to do with the fact that Windows 7 doesn't support UEFI GOP, which is a protocol in UEFI for displaying stuff on a screen.</li>
			<li>Once you have applied this patch and disabled CSM, you CANNOT boot into Safe Mode, since that disables your GPU drivers. It will just hang and crash. You also CANNOT disable your GPU driver, otherwise Windows 7 will crash.</li>
		</ul>
		<p>You will need a couple things on your system for this patch. Here's a list:</p>
		<ul>
			<li>Obviously, a Windows 7 installer. As noted above, you <b>have</b> to get your GPU drivers installed before applying this patch. If your system supports CSM, enable it for the initial install. If not, you can use NTLite to pre-install the GPU driver in your Windows 7 ISO. You should also probably integrate other important drivers as well. What you can do to boot the installer is to take a Windows 8 or 10 installer, then replace sources/install.wim with the Windows 7 install.wim file.</li>
			<li>A Windows 8 or 10 installer to supply the boot files we need to replace.</li>
			<li>Two 8GB or higher capacity thumb drives, one for the Windows 7 installer, and one for the Windows 8 or 10 installer. If you don't have 2 thumb drives, you can use one 16GB thumb drive with Ventoy installed on it. Once Ventoy is set up on the thumb drive, use <b>Windows Explorer</b> to simply copy over the ISO files to the thumb drive. No need for fancy tools like Rufus. Once done, the two ISOs should be sitting next to each other on the thumb drive.</li>
		</ul>
		<p>Alright, now that you have your thumb drive(s) prepared. Follow the steps down below.</p>
		<h1 id="installing-the-os">1: Installing the OS</h1>
		<p>For this, you will need CSM <i>enabled</i> in your BIOS, so make sure to do that.</p>
		<p>Now install Windows 7 as you normally would. Once at the desktop, get your drivers installed, <b><i>ESPECIALLY</i> the GPU drivers!!</b> As mentioned above, you can't get by without a GPU driver, so make sure you install it! And if you installed Chrome, please don't go and then download the GPU driver from Internet Explorer. Just use Chrome. It has a far better chance of ACTUALLY WORKING.</p>
		<h1 id="editing-registry-boot-config">2: Editing the registry and modifying the boot configuration</h1>
		<p>Now that you've installed your GPU driver, and you've verified that it's properly installed (once it's installed, you will nearly always get Aero transparency effects), you need to do a few registry edits and make a few changes to the boot configuration.</p>
		<h2 id="registry-editing">First, edit the registry:</h2>
		<p>Open up Registry Editor like so:</p>
		<p>Once in Registry Editor, navigate to this key: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services<br>Then, find the Vga key under it. In the Vga key, set the Start DWORD value to 4. Do the same for the VgaSave key, which should be right under it.</p>
		<p>If your system doesn't support CSM, NTLite allows you to edit the registry of your image, so mount the SYSTEM hive from there, identify which key it shows up as in Regedit, and the Services key should be under ControlSet001 (CurrentControlSet is normally an alias for ControlSet001). Then do the edits as described above.</p>
		<h2 id="boot-config">Then, change the boot configuration:</h2>
		<p>Now that you've modified the registry, close out of Registry Editor, then open an <span class="underline">administrative</span> Command Prompt. From there, execute the following commands:
		<pre>
			<code>bcdedit /set {current} bootlog yes
bcdedit /set {current} bootstatuspolicy IgnoreAllFailures
bcdedit /set {current} novesa on</code>
		</pre>
		<p>If you are installing on a system that doesn't have CSM, now you have to save the modified image in NTLite, then start installation. Once you have deployed the image and created boot files, DO NOT attempt to boot Windows 7. Instead, boot a Windows 8 or 10 installer (or if you already have a full installation of either of those OSes boot that and open an <span class="underline">admin</span> Command Prompt), then press Shift-F10 to open a privileged Command Prompt. First run this command: <code>bcdedit</code><br>This will show the current boot menu entries. Copy the ID for the Windows 7 entry. Then run the commands above, replacing <code>{current}</code> with the ID of your Windows 7 install. It should be enclosed in curly brackets.</p>
		<h1 id="replace-boot-files">3: Replacing the boot files</h3>
		<p>This stage is the most dangerous part of this entire process. We need to replace several important files on the Windows 7 EFI system partition with their Windows 8/10 versions.</p>
		<p>First, if your system does support CSM, enter the BIOS setup and <span class="underline"><i>disable</i></span> CSM. Now, boot into a Windows 8 or 10 installer (you can use a full installation, but the files are located in different places, so there are separate instructions down below), and press <code>Shift-F10</code> to open up a privileged Command Prompt. Next run these commands to mount the EFI system partition on your Windows 7 install (don't type the two slashes or anything after them, those are to denote comments):</p>
		<pre>
			<code>diskpart
list disk //note the number of the one Win7 is on
select disk 0 //if necessary, replace 0 with the number of your Windows 7 drive
list partition //note the number of the EFI partition, which will be shown as a System partition
select partition 1 //if necessary replace 1 with the number of your ESP
assign letter W
exit //to exit Diskpart</code>
		</pre>
		<p>This will mount the EFI system partition of your Windows 7 drive. Type <code>W:</code> and hit Enter to get to the root of the ESP. Then do the following:</p>
		<pre>
			<code>cd EFI\Microsoft\Boot //this is where most of the files are stored
copy X:\Windows\Boot\EFI\bootmgr.efi //answer "y" when asked to overwrite the file
copy X:\Windows\Boot\EFI\bootmgfw.efi //again, answer "y" when asked to overwrite
copy X:\Windows\Boot\EFI\memtest.efi //keep answering "y"
copy E:\EFI\Microsoft\Boot\Fonts //the drive letter is the letter of the installer USB
copy E:\EFI\Microsoft\Boot\Resources //same thing as the last command with the drive letter
cd ..\..\Boot //".." means the parent directory
copy E:\EFI\Boot\bootx64.efi //answer "y" or IT WON'T WORK</code>
		</pre>
		<h2 id="for-full-win10-install">Special instructions for when you have a full Win8 or 10 install to boot to:</h2>
		<p>This is for when you have a full Windows 8 or 10 installation that you can boot to for this stage. All commands should be run from an <span class="underline">administrative</span> Command Prompt.</p>
		<p>Instead of running the commands above, run these commands:</p>
		<pre>
			<code>diskpart
list disk //note the number of your Win7 drive (IT PROBABLY WON'T BE 0)
select disk 1 //if necessary, change 1 to Win7 drive number
list partition
select partition 1
assign letter W //Windows 7 is W
select disk 0 //use the output of list disk above to verify the Win10 drive number
list partition //ESP should be 1 as before
select partition 1
assign letter L //Windows 8 and 10 are L
exit</code>
		</pre>
		<p>About the only thing different is that you have to mount both systems' EFI partitions. Once again, type <code>W:</code> and hit Enter to get to the root of the <span class="underline">Windows 7</span> ESP. Then run these commands:</p>
		<pre>
			<code>cd EFI\Microsoft\Boot
copy L:\EFI\Microsoft\Boot\EFI\bootmgr.efi //always answer "y" when prompted
copy L:\EFI\Microsoft\Boot\EFI\bootmgfw.efi
copy L:\EFI\Microsoft\Boot\EFI\memtest.efi
copy L:\EFI\Microsoft\Boot\Fonts
copy L:\EFI\Microsoft\Boot\EFI\Resources
cd ..\..\Boot
copy L:\EFI\Boot\bootx64.efi //MAKE SURE TO ANSWER "y"</code>
		</pre>
		<h1 id="boot-windows-7">4: You're done!</h1>
		<p>Now you've finished the setup! Only thing left to do is to reboot and hope it works! Assuming Windows 7 boots normally, I would like to reiterate a couple things I mentioned at the beginning:</p>
		<ul>
			<li>You <b>need to have your GPU driver installed beforehand!!</b> Otherwise Windows 7 will NOT boot!</li>
			<li>With this patch applied, you <b>can't boot in Safe Mode</b>, so hope you never have a reason to need that.</li>
			<li>Most importantly of all, <b><i>DO. NOT. Disable your GPU drivers!!!</i></b> Windows 7 will <b>DIE</b> if you do that!</li>
		</ul>
		<br>
		<h1 id="credits">Credits</h1>
		<p>I based this guide off the work of a somewhat obscure YouTuber known as Bob Pony. Thank you for doing this, man. You can find his guide as a YouTube video <b><a href="https://www.youtube.com/watch?v=J_QV3DqJ9Yk&t=344s">here</a></b>. I would also like to thank Microsoft for keeping these boot files cross-compatible between Windows 7, 8, and 10.</p>
		<p>And with that, I leave you! Whatever you do, try not to die, and DON'T MURDER WINDOWS 7!!!</p>
		<footer id="footer">
			<i>- 29-May-2024 LightSaber236</i>
		</footer>
	</body>
</html>